!function(e){var a=new BMap.Map("container"),t=new BMap.Point((-122.395902231236),37.7593037663834);a.centerAndZoom(t,15),a.enableScrollWheelZoom(!0);var n=new BMap.Marker(t,{icon:new BMap.Symbol(BMap_Symbol_SHAPE_POINT,{scale:1.5,fillColor:"orange",fillOpacity:.8})});n.enableDragging();var o=new BMap.Label("Move me to find trucks",{offset:new BMap.Size(20,(-10))});o.setStyle({fontSize:"14px",border:"0px",height:"20px",lineHeight:"20px",fontFamily:"微软雅黑"}),o.addEventListener("click",function(e){a.removeOverlay(this)}),n.setLabel(o),n.setTitle("Move me to find food trucks nearby"),n.disableMassClear(),n.setAnimation(BMAP_ANIMATION_BOUNCE),a.addOverlay(n),setTimeout(function(){n.setAnimation(null)},3e3);var i={width:300,height:0,title:"信息窗口",enableMessage:!0},r=function(e,t,n){return function(o){var i=new BMap.InfoWindow(t,e);a.openInfoWindow(i,n)}};n.addEventListener("dragend",function(t){var o=t.point;a.clearOverlays(),e.ajax({url:"service.php?f=getnear",type:"POST",async:!0,data:o,dataType:"json"}).done(function(t){t?t.status?t.data&&t.data.length>0?(e.each(t.data,function(t,n){var o=new BMap.Point(n.lng,n.lat),l=new BMap.Marker(o);a.addOverlay(l);var d='<p style="height: 100px; overflow-y: auto">FacilityType: '+n.facilitytype+"<br/>LocationDescription: "+n.locationdescription+"<br/>Address: "+n.address+"<br/>FoodItems: "+n.fooditems+"</p>",s=e.extend({},i);s.title=n.applicant,l.addEventListener("click",r(s,d,o))}),a.setCenter(n.getPosition())):alert("There is no food truck near"):alert(t.msg):alert("Failed to get near food trucks")}).fail(function(){alert("Failed to get near food trucks")})});var l=function(t,n){e.ajax({url:"service.php?f=search",type:"POST",async:!0,data:{searchval:t,lng:n.lng,lat:n.lat},dataType:"json"}).done(function(t){t?t.status?t.data&&t.data.length>0?(e.each(t.data,function(t,n){var o=new BMap.Point(n.lng,n.lat),l=new BMap.Marker(o);a.addOverlay(l);var d='<p style="height: 100px; overflow-y: auto">FacilityType: '+n.facilitytype+"<br/>LocationDescription: "+n.locationdescription+"<br/>Address: "+n.address+"<br/>FoodItems: "+n.fooditems+"</p>",s=e.extend({},i);s.title=n.applicant,l.addEventListener("click",r(s,d,o))}),a.centerAndZoom(new BMap.Point(t.data[0].lng,t.data[0].lat),15)):alert("There is no matched food truck"):alert(t.msg):alert("Failed to search food truck")}).fail(function(){alert("Failed to search food trucks")})};e("#btn_search").on("click",function(){var t=e("#inp_search").val();""!=e.trim(t)&&(l(t,n.getPosition()),a.clearOverlays())}),e("#inp_search").on("keydown",function(t){var o=e(this).val();13==t.keyCode&&""!=e.trim(o)&&(l(o,n.getPosition()),a.clearOverlays())})}(window.jQuery);